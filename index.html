<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Display System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #1a1a1a;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 0 2rem;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.875rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border: 1px solid #d0d0d0;
            background: white;
            border-radius: 6px;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            color: #1a1a1a;
        }

        .btn:hover {
            background: #fafafa;
            border-color: #a0a0a0;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            border-color: #1d4ed8;
        }

        .main-content {
            height: calc(100vh - 70px);
            overflow-y: auto;
            padding: 1.5rem 2rem;
        }

        .queues-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .preparing-section {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .queue-column {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            min-height: 300px;
        }

        .queue-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .queue-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: #1a1a1a;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .queue-count {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.625rem;
            border-radius: 12px;
            font-size: 0.8125rem;
            font-weight: 600;
        }

        .queue-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .order-ticket {
            background: #fafafa;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            padding: 1rem;
            transition: all 0.15s;
        }

        .order-ticket:hover {
            border-color: #c0c0c0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }

        .order-meta {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.625rem;
        }

        .order-number {
            font-size: 0.8125rem;
            color: #666;
            font-weight: 500;
        }

        .order-type {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .type-delivery {
            background: #fef3c7;
            color: #92400e;
        }

        .type-takeout {
            background: #dbeafe;
            color: #1e40af;
        }

        .type-dinein {
            background: #f3e8ff;
            color: #6b21a8;
        }

        .order-customer {
            font-size: 1.0625rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 0.5rem;
        }

        .order-items {
            color: #525252;
            font-size: 0.9375rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0.75rem;
            border-top: 1px solid #e5e5e5;
        }

        .order-time {
            font-size: 0.8125rem;
            color: #737373;
        }

        .btn-complete {
            padding: 0.375rem 0.875rem;
            background: #16a34a;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.8125rem;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-complete:hover {
            background: #15803d;
        }

        .empty-queue {
            padding: 3rem 1rem;
            text-align: center;
            color: #a3a3a3;
            font-size: 0.9375rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-dialog {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #404040;
            margin-bottom: 0.5rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            font-size: 0.9375rem;
            color: #1a1a1a;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        @media (max-width: 1200px) {
            .queues-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .preparing-section {
                grid-column: 1 / -1;
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .queues-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="header">
    <div class="logo">Kitchen Display</div>
    <div class="stats">
        <div class="stat-item">
            <div>
                <div class="stat-label">Pending</div>
                <div class="stat-value" id="statPending">0</div>
            </div>
        </div>
        <div class="stat-item">
            <div>
                <div class="stat-label">In Progress</div>
                <div class="stat-value" id="statPreparing">0</div>
            </div>
        </div>
        <div class="stat-item">
            <div>
                <div class="stat-label">Done</div>
                <div class="stat-value" id="statCompleted">0</div>
            </div>
        </div>
    </div>
    <div class="header-actions">
        <button class="btn btn-primary" onclick="openNewOrderModal()">+ New Order</button>
        <button class="btn" onclick="getNextOrder()">Process Next</button>
        <button class="btn" onclick="clearCompleted()">Clear Done</button>
    </div>
</div>

<div class="main-content">
    <div class="queues-grid">
        <div class="queue-column">
            <div class="queue-header">
                <span class="queue-title">Delivery</span>
                <span class="queue-count" id="deliveryCount">0</span>
            </div>
            <div class="queue-body" id="deliveryQueue"></div>
        </div>

        <div class="queue-column">
            <div class="queue-header">
                <span class="queue-title">Takeout</span>
                <span class="queue-count" id="takeoutCount">0</span>
            </div>
            <div class="queue-body" id="takeoutQueue"></div>
        </div>

        <div class="queue-column">
            <div class="queue-header">
                <span class="queue-title">Dine-In</span>
                <span class="queue-count" id="dineInCount">0</span>
            </div>
            <div class="queue-body" id="dineInQueue"></div>
        </div>
    </div>

    <div class="preparing-section">
        <div class="queue-column">
            <div class="queue-header">
                <span class="queue-title">Preparing</span>
                <span class="queue-count" id="preparingCount">0</span>
            </div>
            <div class="queue-body" id="preparingQueue"></div>
        </div>

        <div class="queue-column">
            <div class="queue-header">
                <span class="queue-title">Completed</span>
                <span class="queue-count" id="completedCount">0</span>
            </div>
            <div class="queue-body" id="completedQueue"></div>
        </div>
    </div>
</div>

<div class="modal" id="newOrderModal">
    <div class="modal-dialog">
        <div class="modal-header">
            <h2 class="modal-title">New Order</h2>
        </div>
        <form onsubmit="submitOrder(event)">
            <div class="modal-body">
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label>Order Type</label>
                    <select id="orderType" required>
                        <option value="">Select type...</option>
                        <option value="delivery">Delivery</option>
                        <option value="takeout">Takeout</option>
                        <option value="dine-in">Dine-In</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Order Items</label>
                    <textarea id="orderItems" required placeholder="e.g., 2x Cheeseburger, 1x Large Fries, 2x Coke"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Place Order</button>
            </div>
        </form>
    </div>
</div>

<script>
    const API_URL = 'http://localhost:8080/api';

    function openNewOrderModal() {
        document.getElementById('newOrderModal').classList.add('active');
    }

    function closeModal() {
        document.getElementById('newOrderModal').classList.remove('active');
        document.getElementById('customerName').value = '';
        document.getElementById('orderType').value = '';
        document.getElementById('orderItems').value = '';
    }

    async function submitOrder(e) {
        e.preventDefault();

        const data = {
            customerName: document.getElementById('customerName').value,
            orderType: document.getElementById('orderType').value,
            items: document.getElementById('orderItems').value
        };

        try {
            const response = await fetch(`${API_URL}/orders`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                closeModal();
                refreshQueues();
            } else {
                alert('Failed to place order');
            }
        } catch (error) {
            alert('Error: ' + error.message);
        }
    }

    async function getNextOrder() {
        try {
            const response = await fetch(`${API_URL}/orders/next`);
            const data = await response.json();

            if (data.status === 'success') {
                refreshQueues();
            } else {
                alert('No pending orders');
            }
        } catch (error) {
            alert('Error: ' + error.message);
        }
    }

    async function completeOrder(orderId) {
        try {
            const response = await fetch(`${API_URL}/orders/${orderId}/complete`, {
                method: 'POST'
            });

            if (response.ok) {
                refreshQueues();
            }
        } catch (error) {
            alert('Error: ' + error.message);
        }
    }

    async function clearCompleted() {
        try {
            await fetch(`${API_URL}/completed`, { method: 'DELETE' });
            refreshQueues();
        } catch (error) {
            alert('Error: ' + error.message);
        }
    }

    function renderQueue(queueData, containerId) {
        const container = document.getElementById(containerId);

        if (!queueData.orders || queueData.orders.length === 0) {
            container.innerHTML = '<div class="empty-queue">No orders</div>';
            return;
        }

        container.innerHTML = queueData.orders.map(order => {
            const typeClass = order.orderType === 'delivery' ? 'type-delivery' :
                order.orderType === 'takeout' ? 'type-takeout' : 'type-dinein';
            const typeLabel = order.orderType === 'delivery' ? 'Delivery' :
                order.orderType === 'takeout' ? 'Takeout' : 'Dine-In';

            const completeBtn = order.status === 'preparing' ?
                `<button class="btn-complete" onclick="completeOrder(${order.id})">Complete</button>` : '';

            return `
                    <div class="order-ticket">
                        <div class="order-meta">
                            <span class="order-number">#${order.id}</span>
                            <span class="order-type ${typeClass}">${typeLabel}</span>
                        </div>
                        <div class="order-customer">${order.customerName}</div>
                        <div class="order-items">${order.items}</div>
                        <div class="order-footer">
                            <span class="order-time">${formatTime(order.timestamp)}</span>
                            ${completeBtn}
                        </div>
                    </div>
                `;
        }).join('');
    }

    function formatTime(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    }

    async function refreshQueues() {
        try {
            const response = await fetch(`${API_URL}/queues`);
            const data = await response.json();

            document.getElementById('statPending').textContent = data.stats.totalPending;
            document.getElementById('statPreparing').textContent = data.stats.totalPreparing;
            document.getElementById('statCompleted').textContent = data.stats.totalCompleted;

            document.getElementById('deliveryCount').textContent = data.delivery.count;
            document.getElementById('takeoutCount').textContent = data.takeout.count;
            document.getElementById('dineInCount').textContent = data.dineIn.count;
            document.getElementById('preparingCount').textContent = data.preparing.count;
            document.getElementById('completedCount').textContent = data.completed.count;

            renderQueue(data.delivery, 'deliveryQueue');
            renderQueue(data.takeout, 'takeoutQueue');
            renderQueue(data.dineIn, 'dineInQueue');
            renderQueue(data.preparing, 'preparingQueue');
            renderQueue(data.completed, 'completedQueue');
        } catch (error) {
            console.error('Error refreshing queues:', error);
        }
    }

    setInterval(refreshQueues, 5000);
    refreshQueues();
</script>
</body>
</html>